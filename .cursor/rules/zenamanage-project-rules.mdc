alwaysApply: true
Last Updated: 2025-10-05
Reference: Lu√¥n tham chi·∫øu v√† tu√¢n th·ªß DOCUMENTATION_INDEX.md ƒë·ªÉ xem danh m·ª•c v√† ƒë·ªçc t·∫•t c·∫£ t√†i li·ªáu li√™n quan.
üéØ PROJECT CONTEXT
Laravel-based multi-tenant project management system v·ªõi strict architectural principles, clear separation UI/API, v√† single source of truth trong c·∫£ code l·∫´n documentation.
1. ARCHITECTURE COMPLIANCE
UI renders only ‚Äî all business logic trong API/Services.
Web routes: session auth + tenant scope only.
API routes: auth:sanctum + ability (admin/tenant).
No side-effects trong UI routes ‚Üí m·ªçi write qua API.
Separation r√µ: /admin/* (system-wide) ‚â† /app/* (tenant-scoped).
Blade Views: 1 endpoint = 1 deterministic view (resources/views/app/<domain>/index.blade.php).
T√°i s·ª≠ d·ª•ng UI b·∫±ng Blade components (resources/views/components/**).
2. NAMING CONVENTIONS
Routes: kebab-case (/app/projects), plural cho lists, singular+id cho detail.
Controllers/Services: PascalCase + verbs (ProjectService.updateBudget).
DB schema: snake_case, c√≥ FK, deleted_at cho soft delete.
Enums: fixed sets (status ‚àà {planning, active, on_hold, completed, cancelled}).
Views: resources/views/app/<domain>/<action>.blade.php.
Components: resources/views/components/<domain>/<component>.blade.php, g·ªçi qua <x-domain.component />.
3. ERROR HANDLING & API CONTRACTS
M·ªçi API response ph·∫£i d√πng App\Support\ApiResponse:
Envelope chu·∫©n, i18n-ready.
Lu√¥n include error.id (map v·ªõi logs / X-Request-Id).
HTTP mapping:
400 validation, 401 auth, 403 authz, 404 not found, 409 conflict,
422 domain validation, 429 rate limit, 500 internal, 503 maintenance.
Retry-After header b·∫Øt bu·ªôc v·ªõi 429/503.
4. MULTI-TENANT ISOLATION
M·ªçi query b·∫Øt bu·ªôc filter tenant_id.
Enforcement t·∫°i Repository/Service layer.
Test isolation: prove tenant A kh√¥ng ƒë·ªçc ƒë∆∞·ª£c d·ªØ li·ªáu tenant B.
DB indexes: composite (tenant_id, foreign_key).
5. TESTING REQUIREMENTS
Unit: Services, mappers, validators.
Integration: Controllers + DB + auth + RBAC + tenant.
E2E: login ‚Üí dashboard ‚Üí projects ‚Üí tasks.
Isolation tests: tenant separation.
Smoke/Deterministic tests: ngƒÉn ‚Äú2 view/endpoint‚Äù.
CI gate: t·∫•t c·∫£ tests pass, kh√¥ng flaky.
6. PERFORMANCE STANDARDS
Pages: p95 < 500ms (20‚Äì50 rows).
APIs: p95 < 300ms.
Cache strategy: KPI/insights 60s per tenant.
Feature flags: cache 300s per tenant.
Optimize queries: avoid N+1, projections, eager load.
7. SECURITY REQUIREMENTS
RBAC theo config/permissions.php (roles: super_admin, PM, Member, Client).
Auth: Admin API (auth:sanctum + ability:admin), App API (auth:sanctum + ability:tenant).
Protection: CSRF cho web, tokens cho API.
Headers: CSP, CORS, HSTS, Secure cookies (middleware SecureHeaders).
Rate limiting: throttle:public cho endpoints c√¥ng khai.
2FA optional (feature flag).
8. LOGGING & MONITORING
Structured logs (JSON): timestamp, level, tenant_id, user_id, X-Request-Id, route, latency, result.
Middleware RequestId: propagate + log correlation.
Severity: DEBUG, INFO, WARN, ERROR, CRITICAL.
Redaction policy: mask secrets/PII trong logs & errors.
üö´ ABSOLUTE PROHIBITIONS
‚ùå Routes kh√¥ng middleware.
‚ùå Query kh√¥ng filter tenant_id.
‚ùå Error handling generic, b·ªè error.id.
‚ùå Commit code kh√¥ng c√≥ tests.
‚ùå Hardcoded values / magic numbers.
‚ùå Duplicate functionality.
‚ùå B·ªè qua security validation.
‚ùå Vi ph·∫°m performance budgets.
‚ùå Debug code trong production.
‚ùå Orphaned data.
‚ùå T·∫°o view song song cho c√πng endpoint.
‚ùå S·ª≠a file docs trong m·ª•c LEGACY.
‚úÖ MANDATORY ACTIONS
Validate inputs v·ªõi schema.
Error handling qua ApiResponse + error.id.
Add tenant_id cho m·ªçi query.
Test cho m·ªçi t√≠nh nƒÉng m·ªõi.
Update docs ‚Üí COMPLETE_SYSTEM_DOCUMENTATION.md + DOCUMENTATION_INDEX.md.
Theo naming conventions.
Logging correlation IDs.
Performance impact check.
Security review.
Multi-tenant isolation verified.
ADR update khi thay ƒë·ªïi ki·∫øn tr√∫c.
üîç CODE REVIEW CHECKLIST
Before Any Change
 Architecture compliance
 Security implications
 Performance impact
 Tenant isolation
 Error handling plan
During Development
 Tests written & passing
 Naming conventions ok
 Error handling via ApiResponse
 Logging with RequestId
 Docs updated (index + complete)
Before Completion
 All tests pass
 Performance budgets met
 Security review done
 Docs complete & consistent
 ADRs updated if needed
üìä SUCCESS METRICS
Code
100% coverage cho code m·ªõi.
0 security vulnerabilities.
<500ms p95 pages, <300ms p95 APIs.
0 tenant isolation violations.
Docs
100% endpoints documented (OpenAPI).
Errors c√≥ example.
ADRs c·∫≠p nh·∫≠t.
Benchmarks l∆∞u trong docs/PERFORMANCE_BENCHMARKS.md.
Documentation index nh·∫•t qu√°n.
üö® ESCALATION RULES
CRITICAL (Block All): Security holes, data isolation broken, performance regression, architecture violation.
HIGH (Block Merge): Missing tests, docs gaps, error handling gaps.
MEDIUM (Fix in PR): Naming/style violations, minor optimizations.
üéØ AI ASSISTANT COMMITMENT
T√¥i commit:
Tu√¢n th·ªß nghi√™m ki·∫øn tr√∫c, rule & docs index.
Kh√¥ng bao gi·ªù compromise security/performance.
Lu√¥n validate multi-tenant isolation.
Lu√¥n d√πng ApiResponse cho errors.
Vi·∫øt test & c·∫≠p nh·∫≠t docs (bao g·ªìm DOCUMENTATION_INDEX.md).
Duy tr√¨ code quality.
∆Øu ti√™n user experience.
ƒê·∫£m b·∫£o reliability.