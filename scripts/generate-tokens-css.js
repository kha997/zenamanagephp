const fs = require('fs');
const path = require('path');

/**
 * Generate CSS variables from design tokens
 * 
 * Reads token values from frontend/src/shared/tokens/ and generates
 * CSS variables for use in both React and Blade.
 * 
 * Run: npm run generate:tokens-css
 */

// Token definitions (matching frontend/src/shared/tokens/)
const tokens = {
  colors: {
    accent: {
      light: { base: '#0A84FF', hover: '#006FE8', ring: 'rgba(10,132,255,0.35)' },
      dark: { base: '#0A84FF', hover: '#3B93FF', ring: 'rgba(10,132,255,0.45)' },
    },
    neutral: {
      light: {
        '50': '#F8FAFC', '100': '#F1F5F9', '200': '#E2E8F0', '300': '#CBD5E1',
        '400': '#94A3B8', '500': '#64748B', '600': '#475569', '700': '#334155',
        '800': '#1E293B', '900': '#0F172A'
      },
      dark: {
        '50': '#111827', '100': '#1F2937', '200': '#273341', '300': '#323F4C',
        '400': '#3F4C58', '500': '#4B5864', '600': '#5B6774', '700': '#748190',
        '800': '#9AA5B1', '900': '#CBD4DD'
      }
    },
    surface: {
      light: {
        bg: '#FFFFFF', surface: '#F8FAFC', muted: '#F1F5F9', subtle: '#E2E8F0',
        border: 'rgba(0,0,0,0.08)', text: '#0B1220', mutedText: '#6B7280'
      },
      dark: {
        bg: '#0B1220', surface: '#0F172A', muted: '#111827', subtle: '#1F2937',
        border: 'rgba(255,255,255,0.08)', text: '#E5E7EB', mutedText: '#94A3B8'
      }
    },
    semantic: {
      success: { light: '#10B981', dark: '#34D399' },
      warning: { light: '#F59E0B', dark: '#FBBF24' },
      error: { light: '#EF4444', dark: '#F87171' },
      info: { light: '#3B82F6', dark: '#60A5FA' },
    },
  },
  spacing: {
    xxs: '4px',
    xs: '8px',
    sm: '12px',
    md: '16px',
    lg: '20px',
    xl: '24px',
    '2xl': '32px',
    '3xl': '40px',
  },
  typography: {
    fontFamily: 'Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif',
    body: { size: '15px', lineHeight: '1.5', weight: '400' },
    heading: {
      h1: { size: '32px', lineHeight: '1.2', weight: '600' },
      h2: { size: '28px', lineHeight: '1.2', weight: '600' },
      h3: { size: '24px', lineHeight: '1.3', weight: '600' },
      h4: { size: '20px', lineHeight: '1.4', weight: '600' },
    },
  },
  radius: {
    sm: '8px',
    md: '10px',
    lg: '12px',
  },
  shadows: {
    xs: '0 1px 2px rgba(0,0,0,0.04)',
    sm: '0 2px 8px rgba(0,0,0,0.06)',
    md: '0 6px 20px rgba(0,0,0,0.08)',
  },
};

function generateCSSVariables() {
  let css = '/**\n';
  css += ' * Design Tokens - Generated from React tokens\n';
  css += ' * DO NOT EDIT MANUALLY - Generated by scripts/generate-tokens-css.js\n';
  css += ' * Source: frontend/src/shared/tokens/\n';
  css += ' * \n';
  css += ' * This file is the single source of truth for design tokens.\n';
  css += ' * Both React and Blade use these CSS variables.\n';
  css += ' */\n\n';
  
  // Light mode (default)
  css += ':root {\n';
  css += generateLightModeVars();
  css += '}\n\n';
  
  // Dark mode
  css += '[data-theme="dark"] {\n';
  css += generateDarkModeVars();
  css += '}\n';
  
  return css;
}

function generateLightModeVars() {
  let vars = '';
  const colors = tokens.colors;
  
  // Accent colors
  vars += `  --accent: ${colors.accent.light.base};\n`;
  vars += `  --accent-hover: ${colors.accent.light.hover};\n`;
  vars += `  --ring: ${colors.accent.light.ring};\n`;
  
  // Surface colors
  const surface = colors.surface.light;
  vars += `  --bg: ${surface.bg};\n`;
  vars += `  --surface: ${surface.surface};\n`;
  vars += `  --muted-surface: ${surface.muted};\n`;
  vars += `  --subtle-surface: ${surface.subtle};\n`;
  vars += `  --border: ${surface.border};\n`;
  vars += `  --text: ${surface.text};\n`;
  vars += `  --muted-text: ${surface.mutedText};\n`;
  
  // Neutral colors
  const neutral = colors.neutral.light;
  Object.entries(neutral).forEach(([shade, value]) => {
    vars += `  --gray-${shade}: ${value};\n`;
  });
  
  // Semantic colors
  vars += `  --success: ${colors.semantic.success.light};\n`;
  vars += `  --warning: ${colors.semantic.warning.light};\n`;
  vars += `  --error: ${colors.semantic.error.light};\n`;
  vars += `  --info: ${colors.semantic.info.light};\n`;
  
  // Spacing
  Object.entries(tokens.spacing).forEach(([size, value]) => {
    vars += `  --space-${size}: ${value};\n`;
  });
  
  // Typography
  vars += `  --font-family: ${tokens.typography.fontFamily};\n`;
  vars += `  --font-body-size: ${tokens.typography.body.size};\n`;
  vars += `  --font-body-line-height: ${tokens.typography.body.lineHeight};\n`;
  vars += `  --font-body-weight: ${tokens.typography.body.weight};\n`;
  Object.entries(tokens.typography.heading).forEach(([level, props]) => {
    vars += `  --font-heading-${level}-size: ${props.size};\n`;
    vars += `  --font-heading-${level}-line-height: ${props.lineHeight};\n`;
    vars += `  --font-heading-${level}-weight: ${props.weight};\n`;
  });
  
  // Radius
  Object.entries(tokens.radius).forEach(([size, value]) => {
    vars += `  --radius-${size}: ${value};\n`;
  });
  
  // Shadows
  Object.entries(tokens.shadows).forEach(([size, value]) => {
    vars += `  --shadow-${size}: ${value};\n`;
  });
  
  return vars;
}

function generateDarkModeVars() {
  let vars = '';
  const colors = tokens.colors;
  
  // Accent colors
  vars += `  --accent: ${colors.accent.dark.base};\n`;
  vars += `  --accent-hover: ${colors.accent.dark.hover};\n`;
  vars += `  --ring: ${colors.accent.dark.ring};\n`;
  
  // Surface colors
  const surface = colors.surface.dark;
  vars += `  --bg: ${surface.bg};\n`;
  vars += `  --surface: ${surface.surface};\n`;
  vars += `  --muted-surface: ${surface.muted};\n`;
  vars += `  --subtle-surface: ${surface.subtle};\n`;
  vars += `  --border: ${surface.border};\n`;
  vars += `  --text: ${surface.text};\n`;
  vars += `  --muted-text: ${surface.mutedText};\n`;
  
  // Neutral colors
  const neutral = colors.neutral.dark;
  Object.entries(neutral).forEach(([shade, value]) => {
    vars += `  --gray-${shade}: ${value};\n`;
  });
  
  // Semantic colors
  vars += `  --success: ${colors.semantic.success.dark};\n`;
  vars += `  --warning: ${colors.semantic.warning.dark};\n`;
  vars += `  --error: ${colors.semantic.error.dark};\n`;
  vars += `  --info: ${colors.semantic.info.dark};\n`;
  
  return vars;
}

const cssContent = generateCSSVariables();
const outputPath = path.join(__dirname, '../resources/css/tokens.css');

fs.writeFileSync(outputPath, cssContent, 'utf8');
console.log(`âœ… Generated tokens.css at ${outputPath}`);
console.log(`   Light mode: ${(cssContent.match(/--accent:/g) || []).length} CSS variables`);
console.log(`   Dark mode: ${(cssContent.match(/\[data-theme="dark"\]/g) || []).length > 0 ? 'enabled' : 'disabled'}`);
